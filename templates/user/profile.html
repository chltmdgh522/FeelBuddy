{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í”„ë¡œí•„ í˜ì´ì§€</title>
    <!-- <link rel="stylesheet" href="{% static '/css/character/character_list/icon.css' %}"> -->
    <link rel="stylesheet" href="{% static '/css/user/profile.css' %}" />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static '/css/character/character_list/nav.css' %}">

    <style>
      input[readonly] {
        border: none;
        background-color: transparent;
      }
      input.editable {
        border: 1px solid #000;
        background-color: #fff;
      }
    </style>
  </head>

  
  <body>

    <!-- ëª¨ë°”ì¼ ë°˜ì‘í˜•-footer ì‹œì‘ -->
<nav class="mobile-footer" role="menulist">
  <a href="{% url 'users:main' %}" role="menuitem" aria-describedby="nav-current">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 20C20 20.5523 19.5523 21 19 21H5C4.44772 21 4 20.5523 4 20V11L1 11L11.3273 1.6115C11.7087 1.26475 12.2913 1.26475 12.6727 1.6115L23 11L20 11V20ZM11 13V19H13V13H11Z"></path>
      </svg>
      Home
  </a>
  <a href="#" role="menuitem">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M10 3H14C18.4183 3 22 6.58172 22 11C22 15.4183 18.4183 19 14 19V22.5C9 20.5 2 17.5 2 11C2 6.58172 5.58172 3 10 3Z"></path>
      </svg>
      Chat
  </a>
  <a href="#" role="menuitem" >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M4 4C4 3.44772 4.44772 3 5 3H10C10.5523 3 11 3.44772 11 4L11 16C11 16.5523 10.5523 17 10 17H5C4.44772 17 4 16.5523 4 16L4 4ZM14 7C13.4477 7 13 7.44772 13 8V16C13 16.5523 13.4477 17 14 17H19C19.5523 17 20 16.5523 20 16V8C20 7.44772 19.5523 7 19 7L14 7ZM21 19L3 19V21H21V19Z"></path>
      </svg>
      Log
  </a>
  <a href="{% url 'character:character_list' %}" role="menuitem">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M8 4H21V6H8V4ZM3 3.5H6V6.5H3V3.5ZM3 10.5H6V13.5H3V10.5ZM3 17.5H6V20.5H3V17.5ZM8 11H21V13H8V11ZM8 18H21V20H8V18Z"></path>
      </svg>
      List
  </a>
  <a href="{% url 'users:profile' %}" role="menuitem" class="active">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 22H4V20C4 17.2386 6.23858 15 9 15H15C17.7614 15 20 17.2386 20 20V22ZM12 13C8.68629 13 6 10.3137 6 7C6 3.68629 8.68629 1 12 1C15.3137 1 18 3.68629 18 7C18 10.3137 15.3137 13 12 13Z"></path>
      </svg>
      Profile
  </a>
  <i class="line" id="nav-current">current item</i>
</nav>

<div class="mobile-profile-container">
  <div id="background">
      <div id="background-image"></div>
  </div>
  <div class="mobile-card">
      <div class="front">
          <div class="top"> </div>
          <div class="bottom">
            <p class="user-name">
              <span id="nickname-display">{{ profile.nickname|default:"ë‹‰ë„¤ì„ ì—†ìŒ" }}</span>
              <input type="text" id="nickname-input" name="nickname" value="{{ profile.nickname }}" style="display:none;">
              <i class="ri-pencil-line" id="edit-nickname-icon"></i>
            </p>
            <div class="profile-email">
              <div class="profile-contact">
                <div class="profile-envelope">
                  <div class="email-top">
                    <div class="email-outer">
                      <div class="email-inner"></div>
                    </div>
                  </div>
                  <div class="email-bottom"></div>
                  <div class="email-left"></div>
                  <div class="email-right"></div>
                  <div class="email-cover"></div>
                  <div class="email-paper">
                    <a class="mail" href="#">
                      <div class="i"></div>
                      {{ user.email }}
                    </a>
                  </div>
                </div>
              </div>
            </div>
              <!-- <div class="info name">lorem</div> -->
              <!-- <div class="info work">Lorem ipsum dolor sit amet.</div> -->
              <div class="info porfolio"> </div>
          </div>
          <div class="picc">
            <form id="profile-pic-form" action="{% url 'users:profile' %}" method="post" enctype="multipart/form-data">
              {% csrf_token %}
              <div class="user-image-container">
                <img
                  id="profile-picture-preview"
                  src="{% if profile.profile_picture %}{{ profile.profile_picture.url }}{% else %}/media/joy.png{% endif %}"
                  class="user-image"
                />
                <i class="ri-pencil-line" id="edit-profile-pic-icon"></i>
                <input type="file" id="profile-pic-input" name="profile_picture" style="display: none;" accept="image/*">
              </div>
            </form>
          </div>
      </div>
      <div class="back"></div>
  </div>
</div>
<!-- ëª¨ë°”ì¼ ë°˜ì‘í˜• - footer ë -->
    <div id="pole">
      <div id="right">
          <div class="logo"><b>P<span>ro</span>f<span>i</span>le</b></div>
      </div>
    </div>
    <!-- í—¤ë” ì•„ì´ì½˜ -->
    <div class="icon">
        <a href="{% url 'users:main' %}">
            <div class="icon__home">

                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 20C20 20.5523 19.5523 21 19 21H5C4.44772 21 4 20.5523 4 20V11L1 11L11.3273 1.6115C11.7087 1.26475 12.2913 1.26475 12.6727 1.6115L23 11L20 11V20ZM11 13V19H13V13H11Z"></path>
                </svg>

            </div>
        </a>
        <a href="{% url 'character:character_list' %}" role="menuitem">
          <div class="icon__list">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8 4H21V6H8V4ZM3 3.5H6V6.5H3V3.5ZM3 10.5H6V13.5H3V10.5ZM3 17.5H6V20.5H3V17.5ZM8 11H21V13H8V11ZM8 18H21V20H8V18Z"></path>
              </svg>
          </div>
        </a>
        
        {% if first_item %}
            <a href="{% url 'chatbot:chatbot_content_list' first_item.pk %}">
                <div class="icon__chat">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 3H14C18.4183 3 22 6.58172 22 11C22 15.4183 18.4183 19 14 19V22.5C9 20.5 2 17.5 2 11C2 6.58172 5.58172 3 10 3Z"></path>
                    </svg>
                </div>
            </a>
        {% endif %}
        <a href="{% url 'chatbot:emotion' %}">
            <div class="icon__log">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M4 4C4 3.44772 4.44772 3 5 3H10C10.5523 3 11 3.44772 11 4L11 16C11 16.5523 10.5523 17 10 17H5C4.44772 17 4 16.5523 4 16L4 4ZM14 7C13.4477 7 13 7.44772 13 8V16C13 16.5523 13.4477 17 14 17H19C19.5523 17 20 16.5523 20 16V8C20 7.44772 19.5523 7 19 7L14 7ZM21 19L3 19V21H21V19Z"></path>
                </svg>
            </div>
        </a>
        <a href="{% url 'character:trash' %}">
            <div class="icon__delete">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM9 11V17H11V11H9ZM13 11V17H15V11H13ZM9 4V6H15V4H9Z"></path>
                </svg>
            </div>
        </a>
    </div>

    

    
      <div class="mountains">
        <div class="mountain-1"></div>
        <div class="mountain-2"></div>
        <div class="land-1"></div>
        <div class="land-2"></div>
        <div class="land-3"></div>
      </div>
      <div class="mountains-base"></div>
      <div class="light-base"></div>
    

    
    
      <!-- í”„ë¡œí•„ì¹´ë“œ ì‹œì‘ -->
      <button class="profile-card" id="profile-btn">
        <div class="profile-left">
          <div class="profile-left-content">
            <!-- í”„ë¡œí•„ ì‚¬ì§„ í‘œì‹œ -->
            <form id="profile-pic-form" action="{% url 'users:profile' %}" method="post" enctype="multipart/form-data">
              {% csrf_token %}
              <div class="user-image-container">
                <img
                  id="profile-picture-preview"
                  src="{% if profile.profile_picture %}{{ profile.profile_picture.url }}{% else %}/media/joy.png{% endif %}"
                  class="user-image"
                />
                <i class="ri-pencil-line" id="edit-profile-pic-icon"></i>
                <input type="file" id="profile-pic-input" name="profile_picture" style="display: none;" accept="image/*">
              </div>
            </form>
            <p class="user-name">
              <span id="nickname-display">{{ profile.nickname|default:"ë‹‰ë„¤ì„ ì—†ìŒ" }}</span>
              <input type="text" id="nickname-input" name="nickname" value="{{ profile.nickname }}" style="display:none;">
              <i class="ri-pencil-line" id="edit-nickname-icon"></i>
            </p>
            <a class="mail" href="#">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3ZM20 7.23792L12.0718 14.338L4 7.21594V19H20V7.23792ZM4.51146 5L12.0619 11.662L19.501 5H4.51146Z"></path></svg>
              <div class="i"></div>
              {{ user.email }} âœğŸ» ğŸ˜ƒ
            </a>
          </div>
        </div>
  
        <div class="profile-right">
          <!-- <div class="profile-email">
            <div class="profile-contact">
              <div class="profile-envelope">
                <div class="email-top">
                  <div class="email-outer">
                    <div class="email-inner"></div>
                  </div>
                </div>
                <div class="email-bottom"></div>
                <div class="email-left"></div>
                <div class="email-right"></div>
                <div class="email-cover"></div>
                <div class="email-paper">
                  <a class="mail" href="#">
                    <div class="i"></div>
                    {{ user.email }}
                  </a>
                </div>
              </div>
            </div>
          </div> -->
          <!-- <div class="profile-right-list">
            <ul>
              
              <li><span class=""></span>Feedback</li>
              <li><span class=""></span>log</li>
              <li><span class=""></span>ëŒ“ê¸€</li>
              <li><span class=""></span>ì¦ì°¾</li>
            </ul>
          </div> -->
        </div>
      </button>

      <!-- ë³„ë˜¥ë³„ -->
    <div class="night">
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
      <div class="shooting_star"></div>
    </div>
    
    <!-- í”„ë¡œí•„ ì¹´ë“œ -->
    
 
 
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    var canvas = document.getElementById("canvas"),
    ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

var stars = [], // Array that contains the stars
    FPS = 60, // Frames per second
    x = canvas.width; // Number of stars

// Push stars to array

for (var i = 0; i < x; i++) {
  stars.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    radius: Math.random(),
    vx: Math.floor(Math.random() * 10) - 5,
    vy: Math.floor(Math.random() * 10) - 5
  });
}

// Draw the scene

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  
  ctx.globalCompositeOperation = "lighter";
  
  for (var i = 0, x = stars.length; i < x; i++) {
    var s = stars[i];
  
    ctx.fillStyle = "#fff";
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.radius, 0, 2 * Math.PI);
    ctx.fill();
  }
}

// Update star locations

function update() {
  for (var i = 0, x = stars.length; i < x; i++) {
    var s = stars[i];
  
    s.x += s.vx / FPS;
    s.y += s.vy / FPS;
    
    if (s.x < 0 || s.x > canvas.width) s.x = -s.x;
    if (s.y < 0 || s.y > canvas.height) s.y = -s.y;
  }
}

// Update and draw

function tick() {
  draw();
  update();
  requestAnimationFrame(tick);
}

tick();
  </script>
  <script>
    function Star(id, x, y){
    this.id = id;
    this.x = x;
    this.y = y;
    this.r = Math.floor(Math.random()*2)+1;
    var alpha = (Math.floor(Math.random()*10)+1)/10/2;
    this.color = "rgba(255,255,255,"+alpha+")";
  }
  
  Star.prototype.draw = function() {
    ctx.fillStyle = this.color;
    ctx.shadowBlur = this.r * 2;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI, false);
    ctx.closePath();
    ctx.fill();
  }
  
  Star.prototype.move = function() {
    this.y -= .15 + params.backgroundSpeed/100;
    if (this.y <= -10) this.y = HEIGHT + 10;
    this.draw();
  }
  
  
  function Dot(id, x, y, r) {
    this.id = id;
    this.x = x;
    this.y = y;
    this.r = Math.floor(Math.random()*5)+1;
    this.maxLinks = 2;
    this.speed = .5;
    this.a = .5;
    this.aReduction = .005;
    this.color = "rgba(255,255,255,"+this.a+")";
    this.linkColor = "rgba(255,255,255,"+this.a/4+")";
  
    this.dir = Math.floor(Math.random()*140)+200;
  }
  
  Dot.prototype.draw = function() {
    ctx.fillStyle = this.color;
    ctx.shadowBlur = this.r * 2;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI, false);
    ctx.closePath();
    ctx.fill();
  }
  
  Dot.prototype.link = function() {
    if (this.id == 0) return;
    var previousDot1 = getPreviousDot(this.id, 1);
    var previousDot2 = getPreviousDot(this.id, 2);
    var previousDot3 = getPreviousDot(this.id, 3);
    if (!previousDot1) return;
    ctx.strokeStyle = this.linkColor;
    ctx.moveTo(previousDot1.x, previousDot1.y);
    ctx.beginPath();
    ctx.lineTo(this.x, this.y);
    if (previousDot2 != false) ctx.lineTo(previousDot2.x, previousDot2.y);
    if (previousDot3 != false) ctx.lineTo(previousDot3.x, previousDot3.y);
    ctx.stroke();
    ctx.closePath();
  }
  
  function getPreviousDot(id, stepback) {
    if (id == 0 || id - stepback < 0) return false;
    if (typeof dots[id - stepback] != "undefined") return dots[id - stepback];
    else return false;//getPreviousDot(id - stepback);
  }
  
  Dot.prototype.move = function() {
    this.a -= this.aReduction;
    if (this.a <= 0) {
      this.die();
      return
    }
    this.color = "rgba(255,255,255,"+this.a+")";
    this.linkColor = "rgba(255,255,255,"+this.a/4+")";
    this.x = this.x + Math.cos(degToRad(this.dir))*(this.speed+params.dotsSpeed/100),
    this.y = this.y + Math.sin(degToRad(this.dir))*(this.speed+params.dotsSpeed/100);
  
    this.draw();
    this.link();
  }
  
  Dot.prototype.die = function() {
      dots[this.id] = null;
      delete dots[this.id];
  }
  
  
  var canvas  = document.getElementById('canvas'),
    ctx = canvas.getContext('2d'),
    WIDTH,
    HEIGHT,
    mouseMoving = false,
    mouseMoveChecker,
    mouseX,
    mouseY,
    stars = [],
    initStarsPopulation = 80,
    dots = [],
    dotsMinDist = 2,
    params = {
      maxDistFromCursor: 50,
      dotsSpeed: 0,
      backgroundSpeed: 0
    };
  
  var gui;
  gui = new dat.GUI();
  gui.add(params, 'maxDistFromCursor').min(0).max(100).step(10).name('Size');
  gui.add(params, 'dotsSpeed').min(0).max(100).step(.5).name('Speed');
  gui.add(params, 'backgroundSpeed').min(0).max(150).step(1).name('Sky speed');
  gui.open();
  
  setCanvasSize();
  init();
  
  function setCanvasSize() {
    WIDTH = document.documentElement.clientWidth,
      HEIGHT = document.documentElement.clientHeight;                      
  
    canvas.setAttribute("width", WIDTH);
    canvas.setAttribute("height", HEIGHT);
  }
  
  function init() {
    ctx.strokeStyle = "white";
    ctx.shadowColor = "white";
    for (var i = 0; i < initStarsPopulation; i++) {
      stars[i] = new Star(i, Math.floor(Math.random()*WIDTH), Math.floor(Math.random()*HEIGHT));
      //stars[i].draw();
    }
    ctx.shadowBlur = 0;
    animate();
  }
  
  function animate() {
      ctx.clearRect(0, 0, WIDTH, HEIGHT);
  
      for (var i in stars) {
        stars[i].move();
      }
      for (var i in dots) {
        dots[i].move();
      }
      drawIfMouseMoving();
      requestAnimationFrame(animate);
  }
  
  window.onmousemove = function(e){
    mouseMoving = true;
    mouseX = e.clientX;
    mouseY = e.clientY;
    clearInterval(mouseMoveChecker);
    mouseMoveChecker = setTimeout(function() {
      mouseMoving = false;
    }, 100);
  }
  
  
  function drawIfMouseMoving(){
    if (!mouseMoving) return;
  
    if (dots.length == 0) {
      dots[0] = new Dot(0, mouseX, mouseY);
      dots[0].draw();
      return;
    }
  
    var previousDot = getPreviousDot(dots.length, 1);
    var prevX = previousDot.x; 
    var prevY = previousDot.y; 
  
    var diffX = Math.abs(prevX - mouseX);
    var diffY = Math.abs(prevY - mouseY);
  
    if (diffX < dotsMinDist || diffY < dotsMinDist) return;
  
    var xVariation = Math.random() > .5 ? -1 : 1;
    xVariation = xVariation*Math.floor(Math.random()*params.maxDistFromCursor)+1;
    var yVariation = Math.random() > .5 ? -1 : 1;
    yVariation = yVariation*Math.floor(Math.random()*params.maxDistFromCursor)+1;
    dots[dots.length] = new Dot(dots.length, mouseX+xVariation, mouseY+yVariation);
    dots[dots.length-1].draw();
    dots[dots.length-1].link();
  }
  //setInterval(drawIfMouseMoving, 17);
  
  function degToRad(deg) {
    return deg * (Math.PI / 180);
  }
  
  
  </script>
  <script>
    // í”„ë¡œí•„ ì¹´ë“œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë³€ìˆ˜
    var isCardStraight = false;
    var isEditing = false;  // í¸ì§‘ ì¤‘ì¸ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë³€ìˆ˜
  
    // í”„ë¡œí•„ ì¹´ë“œ ìƒíƒœë¥¼ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜
    function setCardState(straight) {
      var profileBtn = document.getElementById('profile-btn');
      if (straight) {
        profileBtn.style.transform = 'rotateX(0deg) rotateY(0deg) rotateZ(0deg) translateZ(10px)';
        profileBtn.style.boxShadow = '0px 10px 10px rgba(0, 0, 0, 0.4)';
      } else {
        profileBtn.style.transform = 'rotateX(60deg) rotateY(0deg) rotateZ(45deg)';
        profileBtn.style.boxShadow = '0';
      }
    }
  
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´ë“œë¥¼ ëˆ„ì›ŒìˆëŠ” ìƒíƒœë¡œ ì„¤ì •
    window.addEventListener('load', function() {
      setCardState(false);
    });
  
    // í”„ë¡œí•„ ì¹´ë“œë¥¼ í´ë¦­í–ˆì„ ë•Œ ë˜‘ë°”ë¡œ ì„¸ìš°ëŠ” ê¸°ëŠ¥
    document.getElementById('profile-btn').addEventListener('click', function(event) {
      if (!isCardStraight) {
        setCardState(true);
        isCardStraight = true;
      }
    });
  
    // í˜ì´ì§€ì˜ ë‹¤ë¥¸ ë¶€ë¶„ì„ í´ë¦­í–ˆì„ ë•Œ ì¹´ë“œë¥¼ ì›ë˜ ìƒíƒœë¡œ ëŒë¦¬ëŠ” ê¸°ëŠ¥
    document.addEventListener('click', function(event) {
      var profileBtn = document.getElementById('profile-btn');
      if (isCardStraight && !profileBtn.contains(event.target) && !isEditing) {
        setCardState(false);
        isCardStraight = false;
      }
    });
  
    // í”„ë¡œí•„ ì‚¬ì§„ ìˆ˜ì • ê¸°ëŠ¥
    document.getElementById('edit-profile-pic-icon').addEventListener('click', function(event) {
      event.stopPropagation(); // í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ë¡œ ì „íŒŒë˜ì§€ ì•Šë„ë¡ í•¨
      document.getElementById('profile-pic-input').click();
      isEditing = true;  // í¸ì§‘ ì¤‘ ìƒíƒœë¡œ ì„¤ì •
    });
  
    document.getElementById('profile-pic-input').addEventListener('change', function(event) {
      var formData = new FormData();
      formData.append('profile_picture', event.target.files[0]);
      formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
      
      // ë‹‰ë„¤ì„ë„ í•¨ê»˜ ì „ì†¡
      var nicknameInput = document.getElementById('nickname-input');
      formData.append('nickname', nicknameInput.value);
  
      $.ajax({
        url: "{% url 'users:profile' %}",
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
          // í”„ë¡œí•„ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
          document.getElementById('profile-picture-preview').src = response.profile_picture_url;
          // ë‹‰ë„¤ì„ë„ ì—…ë°ì´íŠ¸ (ë‹‰ë„¤ì„ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡)
          document.getElementById('nickname-display').innerText = response.nickname;
          
          // ì €ì¥ì´ ì™„ë£Œë˜ë©´ ì¹´ë“œë¥¼ ì›ë˜ ìƒíƒœë¡œ ëŒë¦¼
          setCardState(false);
          isCardStraight = false;
          isEditing = false;  // í¸ì§‘ ìƒíƒœ ì¢…ë£Œ
        },
        error: function() {
          alert('í”„ë¡œí•„ ì‚¬ì§„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      });
    });
  
    // ë‹‰ë„¤ì„ ìˆ˜ì • ê¸°ëŠ¥
    document.getElementById('edit-nickname-icon').addEventListener('click', function(event) {
      event.stopPropagation(); // í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ë¡œ ì „íŒŒë˜ì§€ ì•Šë„ë¡ í•¨
      var nicknameDisplay = document.getElementById('nickname-display');
      var nicknameInput = document.getElementById('nickname-input');
      
      nicknameDisplay.style.display = 'none';
      nicknameInput.style.display = 'inline';
      nicknameInput.focus();
      
      // ë‹‰ë„¤ì„ ìˆ˜ì • ì¤‘ì—ëŠ” ì¹´ë“œê°€ ë˜‘ë°”ë¡œ ì„œ ìˆë„ë¡ í•¨
      setCardState(true);
      isCardStraight = true;
      isEditing = true;  // í¸ì§‘ ì¤‘ ìƒíƒœë¡œ ì„¤ì •
    });
  
    document.getElementById('nickname-input').addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        event.preventDefault(); // ê¸°ë³¸ ì—”í„° ë™ì‘(í¼ ì œì¶œ)ì„ ë§‰ìŒ
        saveNickname();
      }
    });
  
    document.getElementById('nickname-input').addEventListener('blur', function() {
      saveNickname();
    });
  
    function saveNickname() {
      var nicknameDisplay = document.getElementById('nickname-display');
      var nicknameInput = document.getElementById('nickname-input');
      
      var formData = new FormData();
      formData.append('nickname', nicknameInput.value);
      formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
  
      $.ajax({
        url: "{% url 'users:profile' %}",
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
          nicknameDisplay.innerText = response.nickname;
          nicknameDisplay.style.display = 'inline';
          nicknameInput.style.display = 'none';
          
          // ì €ì¥ì´ ì™„ë£Œë˜ë©´ ì¹´ë“œë¥¼ ì›ë˜ ìƒíƒœë¡œ ëŒë¦¼
          setCardState(false);
          isCardStraight = false;
          isEditing = false;  // í¸ì§‘ ìƒíƒœ ì¢…ë£Œ
        },
        error: function() {
          alert('ë‹‰ë„¤ì„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      });
    }
  </script>
<!-- <script>
  // í”„ë¡œí•„ ì¹´ë“œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë³€ìˆ˜
  var isCardStraight = false;

  // í”„ë¡œí•„ ì¹´ë“œ ìƒíƒœë¥¼ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜
  function setCardState(straight) {
    var profileBtn = document.getElementById('profile-btn');
    if (straight) {
      profileBtn.style.transform = 'rotateX(0deg) rotateY(0deg) rotateZ(0deg) translateZ(10px)';
      profileBtn.style.boxShadow = '0px 10px 10px rgba(0, 0, 0, 0.4)';
    } else {
      profileBtn.style.transform = 'rotateX(60deg) rotateY(0deg) rotateZ(45deg)';
      profileBtn.style.boxShadow = '0';
    }
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´ë“œë¥¼ ëˆ„ì›ŒìˆëŠ” ìƒíƒœë¡œ ì„¤ì •
  window.addEventListener('load', function() {
    setCardState(false);
  });

  // í”„ë¡œí•„ ì¹´ë“œë¥¼ í´ë¦­í–ˆì„ ë•Œ ë˜‘ë°”ë¡œ ì„¸ìš°ëŠ” ê¸°ëŠ¥
  document.getElementById('profile-btn').addEventListener('click', function(event) {
    if (!isCardStraight) {
      setCardState(true);
      isCardStraight = true;
    }
  });

  // í”„ë¡œí•„ ì‚¬ì§„ ìˆ˜ì • ê¸°ëŠ¥
  document.getElementById('edit-profile-pic-icon').addEventListener('click', function(event) {
    event.stopPropagation(); // í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ë¡œ ì „íŒŒë˜ì§€ ì•Šë„ë¡ í•¨
    document.getElementById('profile-pic-input').click();
  });

  document.getElementById('profile-pic-input').addEventListener('change', function(event) {
    var formData = new FormData();
    formData.append('profile_picture', event.target.files[0]);
    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    
    // ë‹‰ë„¤ì„ë„ í•¨ê»˜ ì „ì†¡
    var nicknameInput = document.getElementById('nickname-input');
    formData.append('nickname', nicknameInput.value);

    $.ajax({
      url: "{% url 'users:profile' %}",
      type: 'POST',
      data: formData,
      processData: false,
      contentType: false,
      success: function(response) {
        // í”„ë¡œí•„ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        document.getElementById('profile-picture-preview').src = response.profile_picture_url;
        // ë‹‰ë„¤ì„ë„ ì—…ë°ì´íŠ¸ (ë‹‰ë„¤ì„ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡)
        document.getElementById('nickname-display').innerText = response.nickname;
        
        // ì €ì¥ì´ ì™„ë£Œë˜ë©´ ì¹´ë“œë¥¼ ì›ë˜ ìƒíƒœë¡œ ëŒë¦¼
        setCardState(false);
        isCardStraight = false;
      },
      error: function() {
        alert('í”„ë¡œí•„ ì‚¬ì§„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
  });

  // ë‹‰ë„¤ì„ ìˆ˜ì • ê¸°ëŠ¥
  document.getElementById('edit-nickname-icon').addEventListener('click', function(event) {
    event.stopPropagation(); // í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ë¡œ ì „íŒŒë˜ì§€ ì•Šë„ë¡ í•¨
    var nicknameDisplay = document.getElementById('nickname-display');
    var nicknameInput = document.getElementById('nickname-input');
    
    nicknameDisplay.style.display = 'none';
    nicknameInput.style.display = 'inline';
    nicknameInput.focus();
    
    // ë‹‰ë„¤ì„ ìˆ˜ì • ì¤‘ì—ëŠ” ì¹´ë“œê°€ ë˜‘ë°”ë¡œ ì„œ ìˆë„ë¡ í•¨
    setCardState(true);
    isCardStraight = true;
  });

  document.getElementById('nickname-input').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault(); // ê¸°ë³¸ ì—”í„° ë™ì‘(í¼ ì œì¶œ)ì„ ë§‰ìŒ
      saveNickname();
    }
  });

  document.getElementById('nickname-input').addEventListener('blur', function() {
    saveNickname();
  });

  function saveNickname() {
    var nicknameDisplay = document.getElementById('nickname-display');
    var nicknameInput = document.getElementById('nickname-input');
    
    var formData = new FormData();
    formData.append('nickname', nicknameInput.value);
    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

    $.ajax({
      url: "{% url 'users:profile' %}",
      type: 'POST',
      data: formData,
      processData: false,
      contentType: false,
      success: function(response) {
        nicknameDisplay.innerText = response.nickname;
        nicknameDisplay.style.display = 'inline';
        nicknameInput.style.display = 'none';
        
        // ì €ì¥ì´ ì™„ë£Œë˜ë©´ ì¹´ë“œë¥¼ ì›ë˜ ìƒíƒœë¡œ ëŒë¦¼
        setCardState(false);
        isCardStraight = false;
      },
      error: function() {
        alert('ë‹‰ë„¤ì„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
  }
</script> -->
<!-- <script>
  // í”„ë¡œí•„ ì¹´ë“œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë³€ìˆ˜
  var isCardStraight = localStorage.getItem('isCardStraight') === 'true';

  // // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´ë“œ ìƒíƒœ ì„¤ì •
  // window.addEventListener('load', function() {
  //   var profileBtn = document.getElementById('profile-btn');
  //   if (isCardStraight) {
  //     // ì¹´ë“œë¥¼ ë°”ë¡œ ì„œ ìˆê²Œ í•¨
  //     profileBtn.style.transform = 'rotateX(0deg) rotateY(0deg) rotateZ(0deg) translateZ(10px)';
  //     profileBtn.style.boxShadow = '0px 10px 10px rgba(0, 0, 0, 0.4)';
  //   } else {
  //     // ì²˜ìŒ ë¡œë“œ ì‹œ ëˆ„ì›Œìˆê²Œ í•¨
  //     profileBtn.style.transform = 'rotateX(60deg) rotateY(0deg) rotateZ(45deg)';
  //     profileBtn.style.boxShadow = '0';
  //   }
  // });

  // í”„ë¡œí•„ ì¹´ë“œë¥¼ í´ë¦­í–ˆì„ ë•Œ ë˜‘ë°”ë¡œ ì„¸ìš°ëŠ” ê¸°ëŠ¥
  document.getElementById('profile-btn').addEventListener('click', function(event) {
    var profileBtn = this;
    if (!isCardStraight) {
      profileBtn.style.transform = 'rotateX(0deg) rotateY(0deg) rotateZ(0deg) translateZ(10px)';
      profileBtn.style.boxShadow = '0px 10px 10px rgba(0, 0, 0, 0.4)';
      isCardStraight = true;
      localStorage.setItem('isCardStraight', 'true');
    }
  });

  // í”„ë¡œí•„ ì‚¬ì§„ ìˆ˜ì • ê¸°ëŠ¥
  document.getElementById('edit-profile-pic-icon').addEventListener('click', function(event) {
    event.stopPropagation(); // í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ë¡œ ì „íŒŒë˜ì§€ ì•Šë„ë¡ í•¨
    document.getElementById('profile-pic-input').click();
  });

  document.getElementById('profile-pic-input').addEventListener('change', function(event) {
    var formData = new FormData();
    formData.append('profile_picture', event.target.files[0]);
    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    
    // ë‹‰ë„¤ì„ë„ í•¨ê»˜ ì „ì†¡
    var nicknameInput = document.getElementById('nickname-input');
    formData.append('nickname', nicknameInput.value);

    $.ajax({
      url: "{% url 'users:profile' %}",
      type: 'POST',
      data: formData,
      processData: false,
      contentType: false,
      success: function(response) {
        // í”„ë¡œí•„ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        document.getElementById('profile-picture-preview').src = response.profile_picture_url;
        // ë‹‰ë„¤ì„ë„ ì—…ë°ì´íŠ¸ (ë‹‰ë„¤ì„ì´ ì‚¬ë¼ì§€ì§€ ì•Šë„ë¡)
        document.getElementById('nickname-display').innerText = response.nickname;
      },
      error: function() {
        alert('í”„ë¡œí•„ ì‚¬ì§„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
  });


  // ë‹‰ë„¤ì„ ìˆ˜ì • ê¸°ëŠ¥
  document.getElementById('edit-nickname-icon').addEventListener('click', function(event) {
    event.stopPropagation(); // í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ë¡œ ì „íŒŒë˜ì§€ ì•Šë„ë¡ í•¨
    var nicknameDisplay = document.getElementById('nickname-display');
    var nicknameInput = document.getElementById('nickname-input');
    
    nicknameDisplay.style.display = 'none';
    nicknameInput.style.display = 'inline';
    nicknameInput.focus();
  });

  document.getElementById('nickname-input').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault(); // ê¸°ë³¸ ì—”í„° ë™ì‘(í¼ ì œì¶œ)ì„ ë§‰ìŒ
      saveNickname();
    }
  });

  document.getElementById('nickname-input').addEventListener('blur', function() {
    saveNickname();
  });

  function saveNickname() {
    var nicknameDisplay = document.getElementById('nickname-display');
    var nicknameInput = document.getElementById('nickname-input');
    
    var formData = new FormData();
    formData.append('nickname', nicknameInput.value);
    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

    $.ajax({
      url: "{% url 'users:profile' %}",
      type: 'POST',
      data: formData,
      processData: false,
      contentType: false,
      success: function(response) {
        nicknameDisplay.innerText = response.nickname;
        nicknameDisplay.style.display = 'inline';
        nicknameInput.style.display = 'none';
      },
      error: function() {
        alert('ë‹‰ë„¤ì„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
  }
</script> -->

<script>
document.querySelectorAll('.logout-btn').forEach(button => {
    button.addEventListener('click', function(event) {
        event.preventDefault();  // ê¸°ë³¸ ë™ì‘ ë§‰ê¸°
        
        const csrfToken = "{{ csrf_token }}";  // CSRF í† í° ê°€ì ¸ì˜¤ê¸° (Django í…œí”Œë¦¿ì—ì„œ)
        const logoutUrl = "{% url 'users:logout' %}";  // ë¡œê·¸ì•„ì›ƒ URL ê°€ì ¸ì˜¤ê¸°

        fetch(logoutUrl, {
            method: 'POST',  // POST ë°©ì‹ìœ¼ë¡œ ìš”ì²­
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken  // CSRF í† í°ì„ í—¤ë”ì— í¬í•¨
            },
            body: JSON.stringify({})  // í•„ìš”í•œ ê²½ìš° ë°ì´í„°ë¥¼ ì—¬ê¸°ì— ì¶”ê°€
        })
        .then(response => {
            if (response.ok) {
                window.location.href = "/";  // ë¡œê·¸ì•„ì›ƒ ì„±ê³µ ì‹œ ë¦¬ë””ë ‰ì…˜í•  í˜ì´ì§€ ì„¤ì •
            } else {
                console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨');
            }
        })
        .catch(error => console.error('ì—ëŸ¬ ë°œìƒ:', error));
    });
});
</script>
</body>
</html>