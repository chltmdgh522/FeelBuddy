{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>감정 로그 페이지</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{% static '/css/emotion/log.css' %}"
      type="text/css"
    />
    <link rel="stylesheet" href="{% static '/css/character/character_list/nav.css' %}">
    <link rel="stylesheet" href="{% static '/css/character/character_list/icon.css' %}">

  </head>
  <body>
    <!-- 특정 변수 디버깅
    <h2>emotion_counts 디버그</h2>
    <pre>{{ emotion_counts|pprint }}</pre>

    <h2>weekly_emotion_counts 디버그</h2>
    <pre>{{ weekly_emotion_counts|pprint }}</pre> -->

    <header class="chat-header" id="header">
      <div class="header-left">
        <a href="피드백 페이지 링크" class="header-feedback">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21.9024 10.5976C21.4442 10.5333 20.976 10.5 20.5 10.5C17.2404 10.5 14.3455 12.0604 12.5212 14.471C12.3501 14.4887 12.1763 14.4978 12 14.4978C10.7188 14.4978 9.55217 14.0172 8.66691 13.2248L7.33309 14.7151C8.41871 15.6868 9.81141 16.3253 11.3466 16.4676C10.8023 17.7016 10.5 19.0662 10.5 20.5C10.5 20.976 10.5333 21.4442 10.5976 21.9024C5.7387 21.2205 2 17.0469 2 12C2 6.47715 6.47715 2 12 2C17.0469 2 21.2205 5.7387 21.9024 10.5976ZM21.8707 12.617C21.4254 12.5401 20.9674 12.5 20.5 12.5C17.7656 12.5 15.3512 13.8709 13.9068 15.9675C13.0194 17.2556 12.5 18.8156 12.5 20.5C12.5 20.9674 12.5401 21.4254 12.617 21.8707L21.8707 12.617ZM8.5 11.5C9.32843 11.5 10 10.8284 10 10C10 9.17157 9.32843 8.5 8.5 8.5C7.67157 8.5 7 9.17157 7 10C7 10.8284 7.67157 11.5 8.5 11.5ZM15.5 11.5C16.3284 11.5 17 10.8284 17 10C17 9.17157 16.3284 8.5 15.5 8.5C14.6716 8.5 14 9.17157 14 10C14 10.8284 14.6716 11.5 15.5 11.5Z"></path></svg>
        </a>
      </div>
      <span><p>Feel Buddy</p></span>
      <div class="header-right">
        <a href="로그아웃" class="header-logout">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C15.2713 2 18.1757 3.57078 20.0002 5.99923L17.2909 5.99931C15.8807 4.75499 14.0285 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C14.029 20 15.8816 19.2446 17.2919 17.9998L20.0009 17.9998C18.1765 20.4288 15.2717 22 12 22ZM19 16V13H11V11H19V8L24 12L19 16Z"></path></svg>
          <!-- <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M5 22C4.44772 22 4 21.5523 4 21V3C4 2.44772 4.44772 2 5 2H19C19.5523 2 20 2.44772 20 3V6H18V4H6V20H18V18H20V21C20 21.5523 19.5523 22 19 22H5ZM18 16V13H11V11H18V8L23 12L18 16Z"></path></svg> -->
        </a>
      </div>
    
    </header>

    <!-- 모바일 반응형-footer 시작 -->
<nav class="mobile-footer" role="menulist">
  <a href="{% url 'users:main' %}" role="menuitem" aria-describedby="nav-current">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 20C20 20.5523 19.5523 21 19 21H5C4.44772 21 4 20.5523 4 20V11L1 11L11.3273 1.6115C11.7087 1.26475 12.2913 1.26475 12.6727 1.6115L23 11L20 11V20ZM11 13V19H13V13H11Z"></path>
      </svg>
      Home
  </a>
  <a href="#" role="menuitem">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M10 3H14C18.4183 3 22 6.58172 22 11C22 15.4183 18.4183 19 14 19V22.5C9 20.5 2 17.5 2 11C2 6.58172 5.58172 3 10 3Z"></path>
      </svg>
      Chat
  </a>
  <a href="#" role="menuitem" class="active">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M4 4C4 3.44772 4.44772 3 5 3H10C10.5523 3 11 3.44772 11 4L11 16C11 16.5523 10.5523 17 10 17H5C4.44772 17 4 16.5523 4 16L4 4ZM14 7C13.4477 7 13 7.44772 13 8V16C13 16.5523 13.4477 17 14 17H19C19.5523 17 20 16.5523 20 16V8C20 7.44772 19.5523 7 19 7L14 7ZM21 19L3 19V21H21V19Z"></path>
      </svg>
      Log
  </a>
  <a href="{% url 'character:character_list' %}" role="menuitem">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M8 4H21V6H8V4ZM3 3.5H6V6.5H3V3.5ZM3 10.5H6V13.5H3V10.5ZM3 17.5H6V20.5H3V17.5ZM8 11H21V13H8V11ZM8 18H21V20H8V18Z"></path>
      </svg>
      List
  </a>
  <a href="{% url 'users:profile' %}" role="menuitem">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 22H4V20C4 17.2386 6.23858 15 9 15H15C17.7614 15 20 17.2386 20 20V22ZM12 13C8.68629 13 6 10.3137 6 7C6 3.68629 8.68629 1 12 1C15.3137 1 18 3.68629 18 7C18 10.3137 15.3137 13 12 13Z"></path>
      </svg>
      Profile
  </a>
  <i class="line" id="nav-current">current item</i>
</nav>
<!-- 모바일 반응형 - footer 끝 -->


<div class="icon">
  <a href="{% url 'users:main' %}" role="menuitem">
      <div class="icon__home">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 20C20 20.5523 19.5523 21 19 21H5C4.44772 21 4 20.5523 4 20V11L1 11L11.3273 1.6115C11.7087 1.26475 12.2913 1.26475 12.6727 1.6115L23 11L20 11V20ZM11 13V19H13V13H11Z"></path>
          </svg>
      </div>
  </a>
  <a href="{% url 'users:profile' %}" role="menuitem">
      <div class="icon__account">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 22H4V20C4 17.2386 6.23858 15 9 15H15C17.7614 15 20 17.2386 20 20V22ZM12 13C8.68629 13 6 10.3137 6 7C6 3.68629 8.68629 1 12 1C15.3137 1 18 3.68629 18 7C18 10.3137 15.3137 13 12 13Z"></path>
          </svg>
      </div>
  </a>
  <a href="{% url 'character:character_list' %}" role="menuitem">
      <div class="icon__list">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 4H21V6H8V4ZM3 3.5H6V6.5H3V3.5ZM3 10.5H6V13.5H3V10.5ZM3 17.5H6V20.5H3V17.5ZM8 11H21V13H8V11ZM8 18H21V20H8V18Z"></path>
          </svg>
      </div>
  </a>
  <a href="{% url 'chatbot:emotion' %}" role="menuitem">
      <div class="icon__log">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M4 4C4 3.44772 4.44772 3 5 3H10C10.5523 3 11 3.44772 11 4L11 16C11 16.5523 10.5523 17 10 17H5C4.44772 17 4 16.5523 4 16L4 4ZM14 7C13.4477 7 13 7.44772 13 8V16C13 16.5523 13.4477 17 14 17H19C19.5523 17 20 16.5523 20 16V8C20 7.44772 19.5523 7 19 7L14 7ZM21 19L3 19V21H21V19Z"></path>
          </svg>
      </div>
  </a>
  <a href="로그아웃">
    <div class="icon__logout">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C15.2713 2 18.1757 3.57078 20.0002 5.99923L17.2909 5.99931C15.8807 4.75499 14.0285 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C14.029 20 15.8816 19.2446 17.2919 17.9998L20.0009 17.9998C18.1765 20.4288 15.2717 22 12 22ZM19 16V13H11V11H19V8L24 12L19 16Z"></path>
        </svg>
        
    </div>
</a>
</div>

<!-- 네온사인 표지판 추가 -->
<div id="pole">
  <div id="right">
      <div class="logo">
          <b>FE<span>EL</span>&nbsp;BU<span>D</span>DY</b>
      </div>
  </div>
</div>
<!-- 네온사인 표지판 추가 끝 -->

    <div class="canvas-center">
      <div class="toggle">
        <input type="checkbox" id="btn">
        <label for="btn">
          <span class="thumb"></span>
        </label>
      </div>

      <div class="canvas">
        <div class="stars">
          <div class="star star-1 opacity-quarter"></div>
          <div class="star star-2 opacity-quarter"></div>
          <div class="star star-3 opacity-half"></div>
          <div class="star star-4 opacity-half"></div>
          <div class="star star-5 opacity-half"></div>
          <div class="star star-6 opacity-half"></div>
          <div class="star star-7"></div>
          <div class="star star-8 opacity-quarter"></div>
          <div class="star star-9 opacity-quarter"></div>
          <div class="star star-10"></div>
          <div class="star star-11"></div>
          <div class="star star-12 opacity-half"></div>
          <div class="star star-13 opacity-quarter"></div>
          <div class="star star-14 opacity-quarter"></div>
          <div class="star star-15"></div>
          <div class="star star-16 opacity-half"></div>
          <div class="star star-17"></div>
          <div class="star star-18 opacity-half"></div>
          <div class="star star-19"></div>
          <div class="star star-20"></div>
          <div class="star star-21"></div>
          <div class="star star-22 opacity-half"></div>
          <div class="star star-23 opacity-quarter"></div>
          <div class="star star-24 opacity-quarter"></div>
          <div class="star star-25 opacity-half"></div>
          <div class="star star-26"></div>
          <div class="star star-27 opacity-half"></div>
          <div class="star star-28 opacity-quarter"></div>
          <div class="star star-29"></div>
          <div class="star star-30 opacity-half"></div>

        </div>
         <div class="shooting-star"></div>
         <div class="sun"></div>
        <div class="forest">
          <div class="tree tree1"></div>
          <div class="tree tree2"></div>
          <div class="tree tree3"></div>
          <div class="tree tree4"></div>
          <div class="tree tree5"></div>
          <div class="tree tree6"></div>
          <div class="tree tree7"></div>
          <div class="tree tree8"></div>
          <div class="tree tree9"></div>
          <div class="tree tree10"></div>
          <div class="tree tree11"></div>
          <div class="tree tree12"></div>
          <div class="tree tree13"></div>
          <div class="tree tree14"></div>
        </div>
        <div class="house">
           <div class="windmill">
        <div class="mill-fan">
          <div class="fan-wing fan-1">
            <div class="fan-comb">
              <ul>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
              </ul>

              </div>
          </div>
           <div class="fan-wing fan-2">
            <div class="fan-comb">
              <ul>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
              </ul>

              </div>
          </div>
           <div class="fan-wing fan-3">
            <div class="fan-comb">
              <ul>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
              </ul>

              </div>
          </div>
           <div class="fan-wing fan-4">
            <div class="fan-comb">
              <ul>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
              </ul>

              </div>
          </div>
        </div>
      </div>
          <div class="roof"></div>
          <div class="floors">
            <div class="light"></div>
            <div class="door"></div>

          </div>
        </div>
      </div>
    </div>

    


    <article>
      <div>
          <h1>Emotion Tracker</h1>
          <p id="description">각 캐릭터와의 누적 대화량을 보여줍니다.</p>
      </div>
      <button id="detailsButton">Show details</button>

      <ul id="dataList">
          {% for emotion, count in emotion_counts.items %}
          <li style="--steps: {{ count }}" tabindex="0" aria-label="{{ emotion }}: {{ count }} steps" data-emotion="{{ emotion }}">
              <b>{{ emotion }}</b>
              <div>{{ count }}</div>
          </li>
          {% endfor %}
      </ul>
  </article>


  <script src="{% static 'js/chatbot/log.js' %}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
        const toggleButton = document.getElementById('btn');
        const description = document.getElementById('description');
        const dataList = document.getElementById('dataList');

        const cumulativeData = {{ emotion_counts|safe }};
        const weeklyData = {{ weekly_emotion_counts|safe }};

        // 각 캐릭터와의 대화량 중 최댓값 가져오기 
        // (그래프의 최대 높이로 설정하기 위함)
        function getMaxValue(data) {
            return Math.max(...Object.values(data));
        }

        // function updateContent() {
        //     if (toggleButton.checked) {
        //         description.textContent = '각 캐릭터와의 일주일 간의 대화량을 보여줍니다.';
        //         updateList(weeklyData);
        //     } else {
        //         description.textContent = '각 캐릭터와의 누적 대화량을 보여줍니다.';
        //         updateList(cumulativeData);
        //     }
        // }

        function updateContent() {
            const data = toggleButton.checked ? weeklyData : cumulativeData;
            const maxValue = getMaxValue(data);

            // CSS 변수로 설정
            document.documentElement.style.setProperty('--max-steps', maxValue);

            if (toggleButton.checked) {
                description.textContent = '각 캐릭터와의 일주일 간의 대화량을 보여줍니다.';
            } else {
                description.textContent = '각 캐릭터와의 누적 대화량을 보여줍니다.';
            }
            updateList(data, maxValue);  // maxValue를 updateList로 전달
        }

        function updateList(data, maxValue) {
            dataList.innerHTML = '';
            for (const [emotion, count] of Object.entries(data)) {
                const li = document.createElement('li');
                li.style.setProperty('--steps', count);
                li.style.setProperty('--max-steps', maxValue); // max-steps 설정
                li.setAttribute('tabindex', '0');
                li.setAttribute('aria-label', `${emotion}: ${count} steps`);
                li.setAttribute('data-emotion', emotion);
                li.innerHTML = `<b>${emotion}</b><div>${count}</div>`;
                dataList.appendChild(li);
            }
        }

        // 초기화 시 최댓값 계산 및 설정
        updateContent();

        // 토글 변경 시 업데이트
        toggleButton.addEventListener('change', updateContent);
    });
</script>
<script>
document.querySelectorAll('.logout-btn').forEach(button => {
    button.addEventListener('click', function(event) {
        event.preventDefault();  // 기본 동작 막기
        
        const csrfToken = "{{ csrf_token }}";  // CSRF 토큰 가져오기 (Django 템플릿에서)
        const logoutUrl = "{% url 'users:logout' %}";  // 로그아웃 URL 가져오기

        fetch(logoutUrl, {
            method: 'POST',  // POST 방식으로 요청
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken  // CSRF 토큰을 헤더에 포함
            },
            body: JSON.stringify({})  // 필요한 경우 데이터를 여기에 추가
        })
        .then(response => {
            if (response.ok) {
                window.location.href = "/";  // 로그아웃 성공 시 리디렉션할 페이지 설정
            } else {
                console.error('로그아웃 실패');
            }
        })
        .catch(error => console.error('에러 발생:', error));
    });
});
</script>
  </body>
</html>