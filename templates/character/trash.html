{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Trash</title>
    <link rel="stylesheet" href="{% static '/css/trash/trash.css' %}">
    <meta name="csrf-token" content="{{ csrf_token }}">

</head>

<body>
<div class="carousel">

    <div class="carousel-control-button left"><input type="radio" name="carousel-control-input"></div>
    <div class="carousel-control-button right"><input type="radio" name="carousel-control-input" checked></div>

    <div class="carousel-rotation-direction">

        <ul class="carousel-item-wrapper" style="--_num-elements: 5">

            {% for trash in character_trash %}
                <li class="carousel-item"
                    data-id="{{ trash.id }}"
                    style="--_index: {{ forloop.counter }}; --_image-url: url('{{ trash.adminCharacter.image.url }}')">
                    <a href="#" target="_blank">{{ trash.name }}</a>
                </li>
            {% endfor %}

            <li class="carousel-ground"></li>

        </ul>

    </div>

</div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const items = document.querySelectorAll('.carousel-item');

        items.forEach(item => {
            item.addEventListener('click', function (event) {
                event.preventDefault();
                const itemName = item.querySelector('a').textContent;
                const itemId = item.getAttribute('data-id');
                const restoreUrl = `/trash/restore/${itemId}`;
                const deleteUrl = `/trash/perfect/delete/${itemId}`;

                // 복구 여부 확인
                if (confirm(`"${itemName}" 항목을 복구하시겠습니까?`)) {
                    // 복구를 선택했을 경우 POST 요청 전송
                    fetch(restoreUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCsrfToken() // CSRF 토큰을 포함시켜야 함
                        },
                        body: JSON.stringify({}) // POST 요청의 본문 (필요시 데이터 추가)
                    }).then(response => {
                        if (response.ok) {
                            window.location.href = restoreUrl; // 요청 후 리디렉션
                        } else {
                            alert('복구 요청 처리 중 오류가 발생했습니다.');
                        }
                    });
                } else {
                    // 복구를 선택하지 않았을 경우 삭제 여부 확인
                    if (confirm(`"${itemName}" 항목을 삭제하시겠습니까?`)) {
                        // 삭제를 선택했을 경우 POST 요청 전송
                        fetch(deleteUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCsrfToken() // CSRF 토큰을 포함시켜야 함
                            },
                            body: JSON.stringify({}) // POST 요청의 본문 (필요시 데이터 추가)
                        }).then(response => {
                            if (response.ok) {
                                window.location.href = deleteUrl; // 요청 후 리디렉션
                            } else {
                                alert('삭제 요청 처리 중 오류가 발생했습니다.');
                            }
                        });
                    }
                }
            });
        });

        function getCsrfToken() {
            // 페이지에서 CSRF 토큰을 찾는 함수
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            return csrfToken;
        }
    });
</script>


</html>