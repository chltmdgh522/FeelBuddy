{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Trash</title>
    <link rel="stylesheet" href="{% static '/css/trash/trash.css' %}">
    <link rel="stylesheet" href="{% static '/css/chatbot/icon.css' %}">
    <meta name="csrf-token" content="{{ csrf_token }}">

</head>

<body>
<!--아이콘 추가된 부분 -->
<!-- <h1>Feelbuddy</h1> -->
<div id="pole">
    <div id="right">
        <div class="logo"><b>FE<span>EL</span>&nbsp;BU<span>D</span>DY</b></div>
    </div>
</div>
<div class="icon">
    <a href="{% url 'users:main' %}">
        <div class="icon__home">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 20C20 20.5523 19.5523 21 19 21H5C4.44772 21 4 20.5523 4 20V11L1 11L11.3273 1.6115C11.7087 1.26475 12.2913 1.26475 12.6727 1.6115L23 11L20 11V20ZM11 13V19H13V13H11Z"></path>
            </svg>
        </div>
    </a>
    <a href="{% url 'users:profile' %}">

        <div class="icon__account">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 22H4V20C4 17.2386 6.23858 15 9 15H15C17.7614 15 20 17.2386 20 20V22ZM12 13C8.68629 13 6 10.3137 6 7C6 3.68629 8.68629 1 12 1C15.3137 1 18 3.68629 18 7C18 10.3137 15.3137 13 12 13Z"></path>
            </svg>
        </div>
    </a>
    <a href="{% url 'character:character_list' %}">

        <div class="icon__chat">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 3H14C18.4183 3 22 6.58172 22 11C22 15.4183 18.4183 19 14 19V22.5C9 20.5 2 17.5 2 11C2 6.58172 5.58172 3 10 3Z"></path>
            </svg>
        </div>
    </a>
    <a href="{% url 'chatbot:emotion' %}">

        <div class="icon__log">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M4 4C4 3.44772 4.44772 3 5 3H10C10.5523 3 11 3.44772 11 4L11 16C11 16.5523 10.5523 17 10 17H5C4.44772 17 4 16.5523 4 16L4 4ZM14 7C13.4477 7 13 7.44772 13 8V16C13 16.5523 13.4477 17 14 17H19C19.5523 17 20 16.5523 20 16V8C20 7.44772 19.5523 7 19 7L14 7ZM21 19L3 19V21H21V19Z"></path>
            </svg>
        </div>
    </a>
    <a href="{% url 'character:trash' %}">

        <div class="icon__delete">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM9 11V17H11V11H9ZM13 11V17H15V11H13ZM9 4V6H15V4H9Z"></path>
            </svg>
        </div>
    </a>
</div>
<!-- 추가된 부분 -->
<div class="carousel">

    <div class="carousel-control-button left"><input type="radio" name="carousel-control-input"></div>
    <div class="carousel-control-button right"><input type="radio" name="carousel-control-input" checked></div>

    <div class="carousel-rotation-direction">

        <ul class="carousel-item-wrapper" style="--_num-elements: 5">

            {% for trash in character_trash %}
                <li class="carousel-item"
                    data-id="{{ trash.id }}"
                    style="--_index: {{ forloop.counter }}; --_image-url: url('{{ trash.adminCharacter.image.url }}')">
                    <a href="#" target="_blank">{{ trash.name }}</a>
                </li>
            {% endfor %}

            <li class="carousel-ground"></li>

        </ul>

    </div>

</div>
<script>
document.querySelectorAll('.logout-btn').forEach(button => {
    button.addEventListener('click', function(event) {
        event.preventDefault();  // 기본 동작 막기
        
        const csrfToken = "{{ csrf_token }}";  // CSRF 토큰 가져오기 (Django 템플릿에서)
        const logoutUrl = "{% url 'users:logout' %}";  // 로그아웃 URL 가져오기

        fetch(logoutUrl, {
            method: 'POST',  // POST 방식으로 요청
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken  // CSRF 토큰을 헤더에 포함
            },
            body: JSON.stringify({})  // 필요한 경우 데이터를 여기에 추가
        })
        .then(response => {
            if (response.ok) {
                window.location.href = "/";  // 로그아웃 성공 시 리디렉션할 페이지 설정
            } else {
                console.error('로그아웃 실패');
            }
        })
        .catch(error => console.error('에러 발생:', error));
    });
});
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const items = document.querySelectorAll('.carousel-item');

        items.forEach(item => {
            item.addEventListener('click', function (event) {
                event.preventDefault();
                const itemName = item.querySelector('a').textContent;
                const itemId = item.getAttribute('data-id');
                const restoreUrl = `/trash/restore/${itemId}`;
                const deleteUrl = `/trash/perfect/delete/${itemId}`;

                // 복구 여부 확인
                if (confirm(`"${itemName}" 항목을 복구하시겠습니까?`)) {
                    // 복구를 선택했을 경우 POST 요청 전송
                    fetch(restoreUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCsrfToken() // CSRF 토큰을 포함시켜야 함
                        },
                        body: JSON.stringify({}) // POST 요청의 본문 (필요시 데이터 추가)
                    }).then(response => {
                        if (response.ok) {
                            window.location.href = restoreUrl; // 요청 후 리디렉션
                        } else {
                            alert('복구 요청 처리 중 오류가 발생했습니다.');
                        }
                    });
                } else {
                    // 복구를 선택하지 않았을 경우 삭제 여부 확인
                    if (confirm(`"${itemName}" 항목을 삭제하시겠습니까?`)) {
                        // 삭제를 선택했을 경우 POST 요청 전송
                        fetch(deleteUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCsrfToken() // CSRF 토큰을 포함시켜야 함
                            },
                            body: JSON.stringify({}) // POST 요청의 본문 (필요시 데이터 추가)
                        }).then(response => {
                            if (response.ok) {
                                window.location.href = deleteUrl; // 요청 후 리디렉션
                            } else {
                                alert('삭제 요청 처리 중 오류가 발생했습니다.');
                            }
                        });
                    }
                }
            });
        });

        function getCsrfToken() {
            // 페이지에서 CSRF 토큰을 찾는 함수
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            return csrfToken;
        }
    });
</script>
</body>

</html>